<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mesto</title>
    <meta name="description" content="" />
    <meta name="Author" content="Alexey Gamov" />
    <link rel="shortcut icon" href="./images/favicon.svg" type="image/x-icon" />
    <link rel="stylesheet" href="./pages/index.css" />
  </head>
  <body class="page">
    <header class="header">
      <a href="/" class="header__logo-box">
        <img
          src="./images/logo.svg"
          alt="Логтип «Место."
          class="logo header__logo"
        />
      </a>
    </header>
    <main class="content">
      <section class="profile">
        <div class="profile__author-box">
          <img
            src="./images/kusto.jpeg"
            alt="Автор профиля."
            class="profile__photo"
          />
          <div class="profile__description">
            <div class="profile__title">
              <h1 class="profile__name">Жак-Ив Кусто</h1>
              <button
                aria-label="Редактировать."
                type="button"
                id="edit-profile"
                class="profile__btn profile__btn_type_edit"
              ></button>
            </div>
            <p class="profile__status">Исследователь океана</p>
          </div>
        </div>
        <button
          id="add-btn"
          type="button"
          class="profile__btn profile__btn_type_add"
          aria-label="Добавить новый пост."
        ></button>
      </section>
      <section class="posts">
        <ul class="posts__container">

          <!-- ========== template for posts starts =========== -->
          <template id="post">
            <li class="post">
              <button type="button" class="post__delete"></button>
              <img
                src=""
                alt=""
                class="post__img"
              />
              <div class="post__description-row">
                <h3 class="post__name"></h3>
                <button type="button" class="post__btn-like"></button>
              </div>
            </li>
          </template>
          <!-- ========== template for posts ends =========== -->

        </ul>
      </section>
    </main>
    <footer class="footer">
      <div class="footer__container">
        <p class="footer__copyright">© 2020 Mesto Russia</p>
      </div>
    </footer>

    <!-- форма обновления профиля -->
    <div id="edit-profile-popup" class="popup">
      <div class="popup__container">
        <button
          type="button"
          id="close-edit-profile"
          class="popup__btn-close"
          aria-label="Закрыть окно."
        ></button>
        <form
          name="profile-edit-form"
          id="profile-edit-form"
          method=""
          action=""
          class="form"
        >
          <h2 class="form__title">Редактировать профиль</h2>
          <feildset class="form__input-container">
            <input
              name="name"
              id="author"
              class="form__item form__item_el_author"
              type="text"
              placeholder="Введите имя профиля"
            />
            <input
              name="status"
              id="status"
              class="form__item form__item_el_status"
              type="text"
              placeholder="Краткое описание профиля"
            />
          </feildset>
          <button type="submit" class="form__btn-save">Сохранить</button>
        </form>
      </div>
    </div>

    <!-- форма добавления поста -->
    <div id="post-add-popup" class="popup">
      <div class="popup__container">
        <button
          type="button"
          id="close-add-popup"
          class="popup__btn-close"
          aria-label="Закрыть окно."
        ></button>
        <form
          name="add-post-form"
          id="add-post-form"
          method=""
          action=""
          class="form"
        >
          <h2 class="form__title">Новое место</h2>
          <feildset class="form__input-container">
            <input
              name="place"
              id="place"
              class="form__item form__item_el_place"
              type="text"
              placeholder="Название"
            />
            <input
              name="img-link"
              id="img-link"
              class="form__item form__item_el_img-link"
              type="URL"
              placeholder="Ссылка на картинку"
            />
          </feildset>
          <button type="submit" class="form__btn-save">Сохранить</button>
        </form>
      </div>
    </div>

      <div id="post-popup" class="popup">
        <div class="popup__container popup__container_type_img">
          <button
            type="button"
            id="close-img-popup"
            class="popup__btn-close"
            aria-label="Закрыть окно."
          ></button>
          <figure class="popup__img">
            <img src="" alt="" class="popup__img-item">
            <figcaption class="popup__img-caption"></figcaption>
          </figure>
        </div>
      </div>

    <script>
      //универсальная функция открытия-закрытия окон
      // function openclose(pop) {
      //   pop.classList.toggle('popup_opened');
      // }
      const openclose = pop => {pop.classList.toggle('popup_opened')};
    </script>

    <script>
      // ====== открытие поп-ап окна редактирования профиля ======
      const editPop = document.querySelector('#edit-profile-popup');
      const btnEdit = document.querySelector('#edit-profile');
      const btnClose = document.querySelector('#close-edit-profile');

      const formElement = document.querySelector('#profile-edit-form');
      const inputName = formElement.querySelector('#author');
      const inputDescr = formElement.querySelector('#status');

      //Функция перезаписи инфы в профиле
      const changeProfile = () => {
        document.querySelector('.profile__name').textContent = inputName.value;
        document.querySelector('.profile__status').textContent = inputDescr.value;
      }

      //Подгрузка в поля значений из вёрстки
      inputName.value = document.querySelector('.profile__name').textContent;
      inputDescr.value = document.querySelector('.profile__status').textContent;

      //Отслеживание кнопок открытия / закрытия окна
      btnEdit.addEventListener('click', () => openclose(editPop));
      btnClose.addEventListener('click', () => openclose(editPop));

      //Отправка формы и перезапись данных
      formElement.addEventListener('submit', evt => {
        evt.preventDefault();
        changeProfile();
        openclose(editPop);
      });
    </script>

    <script>
      // ====== открытие формы на добавление постов ======
      const addPop = document.querySelector('#post-add-popup');
      const btnAdd = document.querySelector('#add-btn');
      const btnAddClose = document.querySelector('#close-add-popup');
      const formAdd = document.querySelector('#add-post-form');

      const imgPop = document.querySelector('#post-popup');
      const btnCloseImgPop = imgPop.querySelector('#close-img-popup');
      let imgPopItem = imgPop.querySelector('.popup__img-item');
      let imgPopCaption = imgPop.querySelector('.popup__img-caption');

      btnCloseImgPop.addEventListener('click', () => {
        openclose(imgPop);
        imgPopItem.src = '';
        imgPopCaption.textContent = '';
      });
      // ====== функция генерации поста в темплейт =======
      const addpost = (inPlace, inLink) => {
        const posts = document.querySelector('.posts__container');
        let postTemplate = document.querySelector('#post').content;
        let postElement = postTemplate.querySelector('.post').cloneNode(true);

        postElement.querySelector('.post__name').textContent = inPlace; //задаём название поста из поля
        postElement.querySelector('.post__img').src = inLink; //задаём адрес картинки из поля

        //Переключение класса кнопки лайка и удаление постов
        // Nebezopasno
          // posts.insertAdjacentHTML('afterbegin', `
          //   <li class="post">
          //     <img
          //       src="${inLink}"
          //       class="post__img"
          //     />
          //     <div class="post__description-row">
          //       <h3 class="post__name">${inPlace}</h3>
          //       <button type="button" class="post__btn-like"></button>
          //     </div>
          //   </li>
          // `);

        postElement.querySelector('.post__btn-like').addEventListener('click', evt => evt.target.classList.toggle('post__btn-like_active'));
        //Удаление постов через корзину
        postElement.querySelector('.post__delete').addEventListener('click', evt => evt.target.parentElement.remove());
        //========================================================================================
        postElement.querySelector('.post__img').addEventListener('click', () => {
          imgPopItem.src = inLink;
          imgPopCaption.textContent = inPlace;
          openclose(imgPop);
        });

        posts.prepend(postElement); //добавляем пост в начало контейнера
      };


      btnAdd.addEventListener('click', () => openclose(addPop));
      btnAddClose.addEventListener('click', () => openclose(addPop));

      //Отправка формы и добавление поста
      formAdd.addEventListener('submit', evt => {
        const inputPlace = formAdd.querySelector('#place');
        const inputLink = formAdd.querySelector('#img-link');

        evt.preventDefault();
        addpost(inputPlace.value, inputLink.value);
        inputPlace.value = '';
        inputLink.value = '';
        openclose(addPop);
      });
    </script>

    <script>
      // ====== Инициализатор 6 постов =======
      function postStartGen() {
        const initialCards = [
          {
            name: 'Карачаевск',
            link: './images/karachaevsk.jpeg'
          },
          {
            name: 'Гора Эльбрус',
            link: './images/elbrus.jpeg'
          },
          {
            name: 'Домбай',
            link: './images/domaby.jpeg'
          },
          {
            name: 'Маттерхорн',
            link: './images/mattern.jpeg'
          },
          {
            name: 'Серро-Торре',
            link: './images/serro.jpeg'
          },
          {
            name: 'Тре-Чиме-ди-Лаваред',
            link: './images/rechime.jpeg'
          },
          {
            name: 'Архыз',
            link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg'
          },
          {
            name: 'Челябинская область',
            link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg'
          },
          {
            name: 'Иваново',
            link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg'
          },
          {
            name: 'Камчатка',
            link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg'
          },
          {
            name: 'Холмогорский район',
            link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg'
          },
          {
            name: 'Байкал',
            link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg'
          }
        ];

        initialCards.forEach(item => addpost(item.name, item.link));
        // обход массива без метода forEach
        // for (let i = 0; i < initialCards.length; i++) {
        //   addpost(initialCards[i].name, initialCards[i].link);
        //   console.log(initialCards[i].name + initialCards[i].link);
        // };
      }

      postStartGen();
    </script>
    <script>

    </script>
  </body>
</html>