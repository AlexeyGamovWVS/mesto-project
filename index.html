<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mesto</title>
    <meta name="description" content="" />
    <meta name="Author" content="Alexey Gamov" />
    <link rel="shortcut icon" href="./images/favicon.svg" type="image/x-icon" />
    <link rel="stylesheet" href="./pages/index.css" />
  </head>
  <body class="page">
    <header class="header">
      <a href="/" class="header__logo-box">
        <img
          src="./images/logo.svg"
          alt="Логтип «Место."
          class="logo header__logo"
        />
      </a>
    </header>
    <main class="content">
      <section class="profile">
        <div class="profile__author-box">
          <img
            src="./images/kusto.jpeg"
            alt="Автор профиля."
            class="profile__photo"
          />
          <div class="profile__description">
            <div class="profile__title">
              <h1 class="profile__name">Жак-Ив Кусто</h1>
              <button
                aria-label="Редактировать."
                type="button"
                id="edit-profile"
                class="profile__btn profile__btn_type_edit"
              ></button>
            </div>
            <p class="profile__status">Исследователь океана</p>
          </div>
        </div>
        <button
          id="add-btn"
          type="button"
          class="profile__btn profile__btn_type_add"
          aria-label="Добавить новый пост."
        ></button>
      </section>
      <section class="posts">
        <ul class="posts__container">

          <!-- ========== template for posts starts =========== -->
          <template id="post">
            <li class="post">
              <button type="button" class="post__delete"></button>
              <img
                src=""
                alt=""
                class="post__img"
              />
              <div class="post__description-row">
                <h3 class="post__name"></h3>
                <button type="button" class="post__btn-like"></button>
              </div>
            </li>
          </template>
          <!-- ========== template for posts ends =========== -->

        </ul>
      </section>
    </main>
    <footer class="footer">
      <div class="footer__container">
        <p class="footer__copyright">© 2020 Mesto Russia</p>
      </div>
    </footer>

    <!-- форма обновления профиля -->
    <div id="edit-profile-popup" class="popup">
      <div class="popup__container">
        <button
          type="button"
          id="close-edit-profile"
          class="popup__btn-close"
          aria-label="Закрыть окно."
        ></button>
        <form
          name="profile-edit-form"
          id="profile-edit-form"
          method=""
          action=""
          class="form"
        >
          <h2 class="form__title">Редактировать профиль</h2>
          <feildset class="form__input-container">
            <input
              name="name"
              id="author"
              class="form__item form__item_el_author"
              type="text"
              placeholder="Введите имя профиля"
            />
            <input
              name="status"
              id="status"
              class="form__item form__item_el_status"
              type="text"
              placeholder="Краткое описание профиля"
            />
          </feildset>
          <button type="submit" class="form__btn-save">Сохранить</button>
        </form>
      </div>
    </div>

    <!-- форма добавления поста -->
    <div id="post-add-popup" class="popup">
      <div class="popup__container">
        <button
          type="button"
          id="close-add-popup"
          class="popup__btn-close"
          aria-label="Закрыть окно."
        ></button>
        <form
          name="add-post-form"
          id="add-post-form"
          method=""
          action=""
          class="form"
        >
          <h2 class="form__title">Новое место</h2>
          <feildset class="form__input-container">
            <input
              name="place"
              id="place"
              class="form__item form__item_el_place"
              type="text"
              placeholder="Название"
            />
            <input
              name="img-link"
              id="img-link"
              class="form__item form__item_el_img-link"
              type="URL"
              placeholder="Ссылка на картинку"
            />
          </feildset>
          <button type="submit" class="form__btn-save">Сохранить</button>
        </form>
      </div>
    </div>

    <script>
      //универсальная функция открытия-закрытия окон
      function openclose(pop) {
        pop.classList.toggle('popup_opened');
      }
    </script>

    <script>
      // ====== открытие поп-ап окна редактирования профиля ======
      const editPop = document.querySelector('#edit-profile-popup');
      const btnEdit = document.querySelector('#edit-profile');
      const btnClose = document.querySelector('#close-edit-profile');

      const formElement = document.querySelector('#profile-edit-form');
      const inputName = formElement.querySelector('#author');
      const inputDescr = formElement.querySelector('#status');

      //Функция перезаписи инфы в профиле
      function changeProfile() {
        document.querySelector('.profile__name').textContent = inputName.value;
        document.querySelector('.profile__status').textContent = inputDescr.value;
      }

      //Подгрузка в поля значений из вёрстки
      inputName.value = document.querySelector('.profile__name').textContent;
      inputDescr.value = document.querySelector('.profile__status').textContent;

      //Отслеживание кнопок открытия / закрытия окна
      btnEdit.addEventListener('click', function() {openclose(editPop)});
      btnClose.addEventListener('click', function() {openclose(editPop)});

      //Отправка формы и перезапись данных
      formElement.addEventListener('submit', function(evt) {
        evt.preventDefault();
        changeProfile();
        openclose(editPop);
      });
    </script>

    <script>
      // ====== открытие формы на добавление постов ======
      const addPop = document.querySelector('#post-add-popup');
      const btnAdd = document.querySelector('#add-btn');
      const btnAddClose = document.querySelector('#close-add-popup');
      const formAdd = document.querySelector('#add-post-form');

      // ====== функция генерации поста в темплейт =======
      function addpost(inPlace, inLink) {
        const posts = document.querySelector('.posts__container');
        let postTemplate = document.querySelector('#post').content;
        let postElement = postTemplate.querySelector('.post').cloneNode(true);

        postElement.querySelector('.post__name').textContent = inPlace; //задаём название поста из поля
        postElement.querySelector('.post__img').src = inLink; //задаём адрес картинки из поля
        console.log(inPlace + inLink);
        //колбэк для переключения класса кнопки лайка
        postElement.querySelector('.post__btn-like').addEventListener('click', function (evt) {
          evt.target.classList.toggle('post__btn-like_active');

        // Nebezopasno
          // posts.insertAdjacentHTML('afterbegin', `
          //   <li class="post">
          //     <img
          //       src="${inLink}"
          //       class="post__img"
          //     />
          //     <div class="post__description-row">
          //       <h3 class="post__name">${inPlace}</h3>
          //       <button type="button" class="post__btn-like"></button>
          //     </div>
          //   </li>
          // `);
        });

        posts.prepend(postElement); //добавляем пост в начало контейнера
      };


      btnAdd.addEventListener('click', function() {openclose(addPop)});
      btnAddClose.addEventListener('click', function() {openclose(addPop)});

      //Отправка формы и добавление поста
      formAdd.addEventListener('submit', function(evt) {
        const inputPlace = formAdd.querySelector('#place');
        const inputLink = formAdd.querySelector('#img-link');

        evt.preventDefault();
        addpost(inputPlace.value, inputLink.value);
        inputPlace.value = '';
        inputLink.value = '';
        openclose(addPop);
      });
    </script>

    <script>
      // ====== Инициализатор 6 постов =======
      function postStartGen() {
        const initialCards = [
          {
            name: 'Карачаевск',
            link: './images/karachaevsk.jpeg'
          },
          {
            name: 'Гора Эльбрус',
            link: './images/elbrus.jpeg'
          },
          {
            name: 'Домбай',
            link: './images/domaby.jpeg'
          },
          {
            name: 'Маттерхорн',
            link: './images/mattern.jpeg'
          },
          {
            name: 'Серро-Торре',
            link: './images/serro.jpeg'
          },
          {
            name: 'Тре-Чиме-ди-Лаваред',
            link: './images/rechime.jpeg'
          }
        ];

        for (let i = 0; i < initialCards.length; i++) {
          addpost(initialCards[i].name, initialCards[i].link);
          console.log(initialCards[i].name + initialCards[i].link);
        };
      }

      postStartGen();
    </script>
  </body>
</html>