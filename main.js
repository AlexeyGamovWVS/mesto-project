(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"],t=["labelSelector","errorElementSelector"];function n(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function o(e,t,n){e.checkValidity()?(t.classList.remove(n),t.disabled=!1):(t.classList.add(n),t.disabled="disabled")}function r(e,t){var n=t.labelSelector,o=t.errorElementSelector,r=t.inputErrorClass,s=t.errorElementClass;Array.from(e).forEach((function(e){var t=e.closest(n).querySelector(o);e.classList.remove(r),t.classList.remove(s)}))}function s(e){e.classList.add("popup_opened"),e.addEventListener("click",u),document.addEventListener("keydown",i)}function c(e){e.classList.remove("popup_opened"),e.removeEventListener("click",u),document.removeEventListener("keydown",i)}function u(e){var t=document.querySelector(".popup_opened");e.target.classList.contains("popup")&&c(t)}function i(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&c(t)}var a={serverAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/",userAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/users/me",cardsAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/cards",headers:{authorization:"8412aadf-3d20-4816-8ed7-02669b62ac0d","Content-Type":"application/json"}};function l(){return fetch(a.userAdress,{headers:a.headers}).then((function(e){return p(e)}))}function p(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status,". Данные не были найдены"))}function d(e,t,n){t.textContent=e,function(e,t){"0"!==e.textContent&&0!==e.textContent?e.classList.remove(t):e.classList.add(t)}(t,n)}var m=["sectionSelector"];var f=document.querySelector("#post-popup"),v=f.querySelector(".popup__img-item"),S=f.querySelector(".popup__img-caption"),h={sectionSelector:".posts__container",postElementSelector:".post",postImageSelector:".post__img",postNameSelector:".post__name",postBtnLikeSelector:".post__btn-like",postBtnLikeActiveClass:"post__btn-like_active",postBtnDelSelector:".post__delete",postBtnDelConfirmSelector:".form__btn-save_type_delete",postLikeAmountSelector:".post__like-amount",postLikeAmountHiddenClass:"post__like-amount_hidden",postTemplateId:"#post",popupImage:f,imagePopup:v,imageCaption:S,deletePopup:document.querySelector("#post-delete-popup")},_={inputSelector:".form__item",inputErrorClass:"form__item_type_error",submitButtonSelector:".form__btn-save",inactiveButtonClass:"form__btn-save_disabled",errorElementSelector:".form__input-error",errorElementClass:"form__input-error_active",labelSelector:".form__field"};function y(e,t,n,o,r,u){var i=e.sectionSelector,l=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,m);document.querySelector(i).prepend(function(e,t,n,o,r,u){var i=function(e,t){return document.querySelector(e).content.querySelector(t).cloneNode(!0)}(e.postTemplateId,e.postElementSelector),l=i.querySelector(e.postImageSelector),m=i.querySelector(e.postNameSelector),f=i.querySelector(e.postLikeAmountSelector),v=o.length;return m.textContent=t,l.src=n,l.setAttribute("alt",t),function(e,t,n,o){!function(e){return e.some((function(e){return"efe1922996bcc79103e54788"===e._id}))}(e)?t.querySelector(n).classList.remove(o):t.querySelector(n).classList.add(o)}(o,i,e.postBtnLikeSelector,e.postBtnLikeActiveClass),d(v,f,e.postLikeAmountHiddenClass),function(e,t,n,o,r,u){var i=e.querySelector(t);"efe1922996bcc79103e54788"!==u?(i.setAttribute("disabled","disabled"),i.style.display="none"):i.addEventListener("click",(function(){var t=n.querySelector(o);s(n),t.addEventListener("click",(function(){var t;t=r,fetch("".concat(a.cardsAdress,"/").concat(t),{method:"DELETE",headers:a.headers}).then((function(e){return p(e)})),c(n),e.remove()}))}))}(i,e.postBtnDelSelector,e.deletePopup,e.postBtnDelConfirmSelector,u,r),function(e,t,n,o,r,s){e.querySelector(t).addEventListener("click",(function(e){var t,c=e.target;c.classList.contains(n)?(c.classList.toggle(n),function(e){return fetch("".concat(a.cardsAdress,"/likes/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return p(e)}))}(o).then((function(e){d(e.likes.length,s,r)})).catch((function(e){return console.log(e)}))):(c.classList.toggle(n),(t=o,fetch("".concat(a.cardsAdress,"/likes/").concat(t),{method:"PUT",headers:a.headers}).then((function(e){return p(e)})).catch((function(e){return console.log(e)}))).then((function(e){d(e.likes.length,s,r)})).catch((function(e){return console.log(e)})))}))}(i,e.postBtnLikeSelector,e.postBtnLikeActiveClass,u,e.postLikeAmountHiddenClass,f),function(e,t,n,o,r,c){e.addEventListener("click",(function(){n.src=o,n.setAttribute("alt",r),c.textContent=r,s(t)}))}(l,e.popupImage,e.imagePopup,n,t,e.imageCaption),i}(l,t,n,o,r,u))}function b(e,t){t.textContent=e?"Сохраняем...":"Сохранить"}var L,g=document.querySelector(".profile__name"),k=document.querySelector(".profile__status"),E=document.querySelector(".profile__photo-item"),C={userName:g,userStatus:k,userImage:E},q=document.querySelector("#edit-profile-popup"),A=document.querySelector("#post-add-popup"),x=document.querySelector("#edit-profile-image-popup"),O=document.forms.profileEditForm,B=document.forms.addPostForm,P=document.forms.profileImageForm,I=O.elements.author,N=O.elements.status,j=B.elements.place,D=B.elements.imgLink,T=P.elements.imgProfileLink,w=document.querySelector("#edit-profile"),H=document.querySelector("#add-btn"),F=document.querySelectorAll(".popup__btn-close"),J=document.querySelector(".profile__photo-item"),M={popup:A,form:B,submitButtonSelector:".form__btn-save",stateClass:"form__btn-save_disabled",inputPlace:j,inputLink:D},z={popup:q,form:O,inputName:I,inputDescr:N,submitSelector:".form__btn-save"},U={popup:x,form:P,input:T,submitSelector:".form__btn-save",stateClass:"form__btn-save_disabled"};w.addEventListener("click",(function(){I.value=g.textContent,N.value=k.textContent,r([I,N],_),s(q)})),J.addEventListener("click",(function(){r([T],_),s(x)})),H.addEventListener("click",(function(){r([D,j],_),s(A)})),F.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return c(t)}))})),l().then((function(e){C.userName.textContent=e.name,C.userStatus.textContent=e.about,C.userImage.src=e.avatar})).catch((function(e){return console.error(e)})),L=h,fetch(a.cardsAdress,{headers:a.headers}).then((function(e){return p(e)})).then((function(e){e.reverse().forEach((function(e){y(L,e.name,e.link,e.likes,e.owner._id,e._id)}))})).catch((function(e){return console.error(e)})),function(r){Array.from(document.forms).forEach((function(s){!function(r,s){var c=s.inputSelector,u=s.submitButtonSelector,i=s.inactiveButtonClass,a=n(s,e),l=Array.from(r.querySelectorAll(c)),p=r.querySelector(u);o(r,p,i),l.forEach((function(e){e.addEventListener("input",(function(){!function(e,o){var r=o.labelSelector,s=o.errorElementSelector,c=n(o,t),u=e.closest(r).querySelector(s);e.validity.valid?function(e,t,n){var o=n.inputErrorClass,r=n.errorElementClass,s=e.validationMessage;e.classList.remove(o),t.textContent=s,t.classList.remove(r)}(e,u,c):function(e,t,n){var o=n.inputErrorClass,r=n.errorElementClass,s=e.validationMessage;e.classList.add(o),t.textContent=s,t.classList.add(r)}(e,u,c)}(e,a),o(r,p,i)}))}))}(s,r)}))}(_),function(e){var t=e.form,n=e.popup,o=e.inputName,r=e.inputDescr,s=e.submitSelector,u=t.querySelector(s);t.addEventListener("submit",(function(e){var t,s;e.preventDefault(),b(!1,u),(t=o.value,s=r.value,fetch(a.userAdress,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:t,about:s})}).then((function(e){return p(e)}))).then((function(){l().then((function(e){C.userName.textContent=e.name,C.userStatus.textContent=e.about,C.userImage.src=e.avatar})).catch((function(e){return console.error(e)}))})).catch((function(e){return console.error(e)})).finally((function(){b(!1,u),c(n)}))}))}(z),function(e,t){var n=e.form,r=e.popup,s=e.inputPlace,u=e.inputLink,i=e.submitButtonSelector,l=e.stateClass,d=n.querySelector(i);n.addEventListener("submit",(function(e){var i,m;e.preventDefault(),b(!0,d),(i=s.value,m=u.value,fetch(a.cardsAdress,{method:"POST",headers:a.headers,body:JSON.stringify({name:i,link:m})}).then((function(e){return p(e)}))).then((function(e){y(t,e.name,e.link,e.likes,e.owner._id)})).catch((function(e){return console.log(e)})).finally((function(){b(!0,d),e.target.reset(),o(n,d,l),c(r)}))}))}(M,h),function(e){var t=e.form.querySelector(e.submitSelector);e.form.addEventListener("submit",(function(n){var r;n.preventDefault(),b(!0,t),(r=e.input.value,fetch("".concat(a.userAdress,"/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:r})}).then((function(e){return p(e)}))).then((function(){l().then((function(e){C.userName.textContent=e.name,C.userStatus.textContent=e.about,C.userImage.src=e.avatar})).catch((function(e){return console.error(e)}))})).catch((function(e){return console.log(e)})).finally((function(){b(!1,t),n.target.reset(),o(e.form,t,e.stateClass),c(e.popup)}))}))}(U)})();