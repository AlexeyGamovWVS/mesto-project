(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"],t=["labelSelector","errorElementSelector"];function o(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)o=s[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)o=s[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}function n(e,t,o){e.checkValidity()?(t.classList.remove(o),t.disabled=!1):(t.classList.add(o),t.disabled="disabled")}function r(e,t){var o=t.labelSelector,n=t.errorElementSelector,r=t.inputErrorClass,s=t.errorElementClass;Array.from(e).forEach((function(e){var t=e.closest(o).querySelector(n);e.classList.remove(r),t.classList.remove(s)}))}function s(e){e.classList.add("popup_opened"),e.addEventListener("click",i),document.addEventListener("keydown",u)}function c(e){e.classList.remove("popup_opened"),e.removeEventListener("click",i),document.removeEventListener("keydown",u)}function i(e){var t=document.querySelector(".popup_opened");e.target.classList.contains("popup")&&c(t)}function u(e){var t=document.querySelector(".popup_opened");"Escape"===e.key&&c(t)}var a={serverAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/",userAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/users/me",cardsAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/cards",headers:{authorization:"8412aadf-3d20-4816-8ed7-02669b62ac0d","Content-Type":"application/json"}};function l(e){fetch(a.userAdress,{headers:a.headers}).then((function(e){return p(e)})).then((function(t){e.userName.textContent=t.name,e.userStatus.textContent=t.about,e.userImage.src=t.avatar})).catch((function(e){return console.error(e)}))}function p(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status,". Данные не были найдены"))}function d(e,t,o){t.textContent=e,function(e,t){"0"!==e.textContent&&0!==e.textContent?e.classList.remove(t):e.classList.add(t)}(t,o)}var m=["sectionSelector"];var f=document.querySelector("#post-popup"),v=f.querySelector(".popup__img-item"),S=f.querySelector(".popup__img-caption"),h={sectionSelector:".posts__container",postElementSelector:".post",postImageSelector:".post__img",postNameSelector:".post__name",postBtnLikeSelector:".post__btn-like",postBtnLikeActiveClass:"post__btn-like_active",postBtnDelSelector:".post__delete",postBtnDelConfirmSelector:".form__btn-save_type_delete",postLikeAmountSelector:".post__like-amount",postLikeAmountHiddenClass:"post__like-amount_hidden",postTemplateId:"#post",popupImage:f,imagePopup:v,imageCaption:S,deletePopup:document.querySelector("#post-delete-popup")},_={inputSelector:".form__item",inputErrorClass:"form__item_type_error",submitButtonSelector:".form__btn-save",inactiveButtonClass:"form__btn-save_disabled",errorElementSelector:".form__input-error",errorElementClass:"form__input-error_active",labelSelector:".form__field"};function y(e,t,o,n,r,i){var u=e.sectionSelector,l=function(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)o=s[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)o=s[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}(e,m);document.querySelector(u).prepend(function(e,t,o,n,r,i){var u=function(e,t){return document.querySelector(e).content.querySelector(t).cloneNode(!0)}(e.postTemplateId,e.postElementSelector),l=u.querySelector(e.postImageSelector),m=u.querySelector(e.postNameSelector),f=u.querySelector(e.postLikeAmountSelector),v=n.length;return m.textContent=t,l.src=o,l.setAttribute("alt",t),function(e,t,o,n){!function(e){return e.some((function(e){return"efe1922996bcc79103e54788"===e._id}))}(e)?t.querySelector(o).classList.remove(n):t.querySelector(o).classList.add(n)}(n,u,e.postBtnLikeSelector,e.postBtnLikeActiveClass),d(v,f,e.postLikeAmountHiddenClass),function(e,t,o,n,r,i){var u=e.querySelector(t);"efe1922996bcc79103e54788"!==i?(u.setAttribute("disabled","disabled"),u.style.display="none"):u.addEventListener("click",(function(){var t=o.querySelector(n);s(o),t.addEventListener("click",(function(){var t;t=r,fetch("".concat(a.cardsAdress,"/").concat(t),{method:"DELETE",headers:a.headers}).then((function(e){return p(e)})).catch((function(e){return console.log(e)})),c(o),e.remove()}))}))}(u,e.postBtnDelSelector,e.deletePopup,e.postBtnDelConfirmSelector,i,r),function(e,t,o,n,r,s){e.querySelector(t).addEventListener("click",(function(e){var t,c=e.target;c.classList.contains(o)?(c.classList.toggle(o),function(e){return fetch("".concat(a.cardsAdress,"/likes/").concat(e),{method:"DELETE",headers:a.headers}).then((function(e){return p(e)}))}(n).then((function(e){d(e.likes.length,s,r)})).catch((function(e){return console.log(e)}))):(c.classList.toggle(o),(t=n,fetch("".concat(a.cardsAdress,"/likes/").concat(t),{method:"PUT",headers:a.headers}).then((function(e){return p(e)}))).then((function(e){d(e.likes.length,s,r)})).catch((function(e){return console.log(e)})))}))}(u,e.postBtnLikeSelector,e.postBtnLikeActiveClass,i,e.postLikeAmountHiddenClass,f),function(e,t,o,n,r,c){e.addEventListener("click",(function(){o.src=n,o.setAttribute("alt",r),c.textContent=r,s(t)}))}(l,e.popupImage,e.imagePopup,o,t,e.imageCaption),u}(l,t,o,n,r,i))}function b(e,t){t.textContent=e?"Сохраняем...":"Сохранить"}var L,g=document.querySelector(".profile__name"),k=document.querySelector(".profile__status"),E=document.querySelector(".profile__photo-item"),C={userName:g,userStatus:k,userImage:E},q=document.querySelector("#edit-profile-popup"),A=document.querySelector("#post-add-popup"),O=document.querySelector("#edit-profile-image-popup"),B=document.forms.profileEditForm,P=document.forms.addPostForm,x=document.forms.profileImageForm,j=B.elements.author,D=B.elements.status,I=P.elements.place,N=P.elements.imgLink,T=x.elements.imgProfileLink,w=document.querySelector("#edit-profile"),H=document.querySelector("#add-btn"),F=document.querySelectorAll(".popup__btn-close"),J=document.querySelector(".profile__photo-item"),M={popup:A,form:P,submitButtonSelector:".form__btn-save",stateClass:"form__btn-save_disabled",inputPlace:I,inputLink:N},z={popup:q,form:B,inputName:j,inputDescr:D,submitSelector:".form__btn-save"},U={popup:O,form:x,input:T,submitSelector:".form__btn-save",stateClass:"form__btn-save_disabled"};w.addEventListener("click",(function(){j.value=g.textContent,D.value=k.textContent,r([j,D],_),s(q)})),J.addEventListener("click",(function(){r([T],_),s(O)})),H.addEventListener("click",(function(){r([N,I],_),s(A)})),F.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return c(t)}))})),l(C),L=h,fetch(a.cardsAdress,{headers:a.headers}).then((function(e){return p(e)})).then((function(e){e.reverse().forEach((function(e){y(L,e.name,e.link,e.likes,e.owner._id,e._id)}))})).catch((function(e){return console.error(e)})),function(r){Array.from(document.forms).forEach((function(s){!function(r,s){var c=s.inputSelector,i=s.submitButtonSelector,u=s.inactiveButtonClass,a=o(s,e),l=Array.from(r.querySelectorAll(c)),p=r.querySelector(i);n(r,p,u),l.forEach((function(e){e.addEventListener("input",(function(){!function(e,n){var r=n.labelSelector,s=n.errorElementSelector,c=o(n,t),i=e.closest(r).querySelector(s);e.validity.valid?function(e,t,o){var n=o.inputErrorClass,r=o.errorElementClass,s=e.validationMessage;e.classList.remove(n),t.textContent=s,t.classList.remove(r)}(e,i,c):function(e,t,o){var n=o.inputErrorClass,r=o.errorElementClass,s=e.validationMessage;e.classList.add(n),t.textContent=s,t.classList.add(r)}(e,i,c)}(e,a),n(r,p,u)}))}))}(s,r)}))}(_),function(e){var t=e.form,o=e.popup,n=e.inputName,r=e.inputDescr,s=e.submitSelector,i=t.querySelector(s);t.addEventListener("submit",(function(e){var t,s;e.preventDefault(),b(!1,i),(t=n.value,s=r.value,fetch(a.userAdress,{method:"PATCH",headers:a.headers,body:JSON.stringify({name:t,about:s})}).then((function(e){return p(e)}))).then((function(){l(C)})).catch((function(e){return console.error(e)})).finally((function(){b(!1,i),c(o)}))}))}(z),function(e,t){var o=e.form,r=e.popup,s=e.inputPlace,i=e.inputLink,u=e.submitButtonSelector,l=e.stateClass,d=o.querySelector(u);o.addEventListener("submit",(function(e){var u,m;e.preventDefault(),b(!0,d),(u=s.value,m=i.value,fetch(a.cardsAdress,{method:"POST",headers:a.headers,body:JSON.stringify({name:u,link:m})}).then((function(e){return p(e)}))).then((function(e){y(t,e.name,e.link,e.likes,e.owner._id)})).catch((function(e){return console.log(e)})).finally((function(){b(!0,d),e.target.reset(),n(o,d,l),c(r)}))}))}(M,h),function(e){var t=e.form.querySelector(e.submitSelector);e.form.addEventListener("submit",(function(o){var r;o.preventDefault(),b(!0,t),(r=e.input.value,fetch("".concat(a.userAdress,"/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:r})}).then((function(e){return p(e)}))).then((function(){return l(C)})).catch((function(e){return console.log(e)})).finally((function(){b(!1,t),o.target.reset(),n(e.form,t,e.stateClass),c(e.popup)}))}))}(U)})();