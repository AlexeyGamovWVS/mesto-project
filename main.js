(()=>{"use strict";var e=["inputSelector","submitButtonSelector","inactiveButtonClass"],t=["labelSelector","errorElementSelector"];function r(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function n(e,t,r){e.checkValidity()?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled="disabled")}function o(e,t){var r=t.labelSelector,n=t.errorElementSelector,o=t.inputErrorClass,s=t.errorElementClass;Array.from(e).forEach((function(e){var t=e.closest(r).querySelector(n);e.classList.remove(o),t.classList.remove(s)}))}function s(e){e.classList.add("popup_opened"),e.addEventListener("click",i),document.addEventListener("keydown",a)}function c(e){e.classList.remove("popup_opened"),e.removeEventListener("click",i),document.removeEventListener("keydown",a)}function i(e){c(e.target)}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_opened"))}var u={serverAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/",userAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/users/me",cardsAdress:"https://mesto.nomoreparties.co/v1/plus-cohort-13/cards",headers:{authorization:"8412aadf-3d20-4816-8ed7-02669b62ac0d","Content-Type":"application/json"}};function l(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status,". Данные не были найдены"))}function d(e,t,r){t.textContent=e,function(e,t){"0"!==e.textContent&&0!==e.textContent&&""!==e.textContent?e.classList.remove(t):e.classList.add(t)}(t,r)}var p=["sectionSelector"];var m=document.querySelector("#post-popup"),f=m.querySelector(".popup__img-item"),v=m.querySelector(".popup__img-caption"),S={sectionSelector:".posts__container",postElementSelector:".post",postImageSelector:".post__img",postNameSelector:".post__name",postBtnLikeSelector:".post__btn-like",postBtnLikeActiveClass:"post__btn-like_active",postBtnDelSelector:".post__delete",postBtnDelConfirmSelector:".form__btn-save_type_delete",postLikeAmountSelector:".post__like-amount",postLikeAmountHiddenClass:"post__like-amount_hidden",postTemplateId:"#post",popupImage:m,imagePopup:f,imageCaption:v,deletePopup:document.querySelector("#post-delete-popup")},h={inputSelector:".form__item",inputErrorClass:"form__item_type_error",submitButtonSelector:".form__btn-save",inactiveButtonClass:"form__btn-save_disabled",errorElementSelector:".form__input-error",errorElementClass:"form__input-error_active",labelSelector:".form__field"};function y(e,t,r,n,o,i){var a=e.sectionSelector,m=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},s=Object.keys(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,p);document.querySelector(a).prepend(function(e,t,r,n,o,i){var a=e.userId,p=function(e,t){return document.querySelector(e).content.querySelector(t).cloneNode(!0)}(e.postTemplateId,e.postElementSelector),m=p.querySelector(e.postImageSelector),f=p.querySelector(e.postNameSelector),v=p.querySelector(e.postLikeAmountSelector),S=n.length;return f.textContent=t,m.src=r,m.setAttribute("alt",t),function(e,t,r,n,o){!function(e,t){return e.some((function(e){return e._id===t}))}(e,o)?t.querySelector(r).classList.remove(n):t.querySelector(r).classList.add(n)}(n,p,e.postBtnLikeSelector,e.postBtnLikeActiveClass,a),d(S,v,e.postLikeAmountHiddenClass),function(e,t,r,n,o,i,a){var d=e.querySelector(t);i!==a?(d.setAttribute("disabled","disabled"),d.style.display="none"):d.addEventListener("click",(function(){var t=r.querySelector(n);s(r),t.onclick=function(){var t;(t=o,fetch("".concat(u.cardsAdress,"/").concat(t),{method:"DELETE",headers:u.headers}).then((function(e){return l(e)}))).then((function(){c(r),e.remove()})).catch((function(e){return console.error(e)}))}}))}(p,e.postBtnDelSelector,e.deletePopup,e.postBtnDelConfirmSelector,i,o,a),function(e,t,r,n,o,s){e.querySelector(t).addEventListener("click",(function(e){var t,c=e.target;c.classList.contains(r)?(c.classList.toggle(r),function(e){return fetch("".concat(u.cardsAdress,"/likes/").concat(e),{method:"DELETE",headers:u.headers}).then((function(e){return l(e)}))}(n).then((function(e){d(e.likes.length,s,o)})).catch((function(e){return console.log(e)}))):(c.classList.toggle(r),(t=n,fetch("".concat(u.cardsAdress,"/likes/").concat(t),{method:"PUT",headers:u.headers}).then((function(e){return l(e)}))).then((function(e){d(e.likes.length,s,o)})).catch((function(e){return console.log(e)})))}))}(p,e.postBtnLikeSelector,e.postBtnLikeActiveClass,i,e.postLikeAmountHiddenClass,v),function(e,t,r,n,o,c){e.addEventListener("click",(function(){r.src=n,r.setAttribute("alt",o),c.textContent=o,s(t)}))}(m,e.popupImage,e.imagePopup,r,t,e.imageCaption),p}(m,t,r,n,o,i))}function _(e,t){t.textContent=e?"Сохраняем...":"Сохранить"}function b(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var g=document.querySelector(".profile__name"),L=document.querySelector(".profile__status"),C=document.querySelector(".profile__photo-item"),k={userName:g,userStatus:L,userImage:C,userId:void 0},E=document.querySelector("#edit-profile-popup"),A=document.querySelector("#post-add-popup"),q=document.querySelector("#edit-profile-image-popup"),x=document.forms.profileEditForm,O=document.forms.addPostForm,I=document.forms.profileImageForm,B=x.elements.author,P=x.elements.status,j=O.elements.place,w=O.elements.imgLink,N=I.elements.imgProfileLink,D=document.querySelector("#edit-profile"),T=document.querySelector("#add-btn"),H=document.querySelectorAll(".popup__btn-close"),F=document.querySelector(".profile__photo-item"),J={popup:A,form:O,submitButtonSelector:".form__btn-save",stateClass:"form__btn-save_disabled",inputPlace:j,inputLink:w},M={popup:E,form:x,inputName:B,inputDescr:P,submitSelector:".form__btn-save"},U={popup:q,form:I,input:N,submitSelector:".form__btn-save",stateClass:"form__btn-save_disabled"};D.addEventListener("click",(function(){B.value=g.textContent,P.value=L.textContent,o([B,P],h),s(E)})),F.addEventListener("click",(function(){o([N],h),s(q)})),T.addEventListener("click",(function(){o([w,j],h),s(A)})),H.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return c(t)}))})),Promise.all([fetch(u.userAdress,{headers:u.headers}).then((function(e){return l(e)})),fetch(u.cardsAdress,{headers:u.headers}).then((function(e){return l(e)}))]).then((function(o){var s,i,a,d=(i=2,function(e){if(Array.isArray(e))return e}(s=o)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,s=[],c=!0,i=!1;try{for(r=r.call(e);!(c=(n=r.next()).done)&&(s.push(n.value),!t||s.length!==t);c=!0);}catch(e){i=!0,o=e}finally{try{c||null==r.return||r.return()}finally{if(i)throw o}}return s}}(s,i)||function(e,t){if(e){if("string"==typeof e)return b(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(e,t):void 0}}(s,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=d[0],m=d[1];k.userName.textContent=p.name,k.userStatus.textContent=p.about,k.userImage.src=p.avatar,k.userId=p._id,S.userId=k.userId,function(e,t){t.reverse().forEach((function(t){y(e,t.name,t.link,t.likes,t.owner._id,t._id)}))}(S,m),a=h,Array.from(document.forms).forEach((function(o){!function(o,s){var c=s.inputSelector,i=s.submitButtonSelector,a=s.inactiveButtonClass,u=r(s,e),l=Array.from(o.querySelectorAll(c)),d=o.querySelector(i);n(o,d,a),l.forEach((function(e){e.addEventListener("input",(function(){!function(e,n){var o=n.labelSelector,s=n.errorElementSelector,c=r(n,t),i=e.closest(o).querySelector(s);e.validity.valid?function(e,t,r){var n=r.inputErrorClass,o=r.errorElementClass,s=e.validationMessage;e.classList.remove(n),t.textContent=s,t.classList.remove(o)}(e,i,c):function(e,t,r){var n=r.inputErrorClass,o=r.errorElementClass,s=e.validationMessage;e.classList.add(n),t.textContent=s,t.classList.add(o)}(e,i,c)}(e,u),n(o,d,a)}))}))}(o,a)})),function(e){var t=e.form,r=e.popup,n=e.inputName,o=e.inputDescr,s=e.submitSelector,i=t.querySelector(s);t.addEventListener("submit",(function(e){var t,s;e.preventDefault(),_(!0,i),(t=n.value,s=o.value,fetch(u.userAdress,{method:"PATCH",headers:u.headers,body:JSON.stringify({name:t,about:s})}).then((function(e){return l(e)}))).then((function(e){k.userName.textContent=e.name,k.userStatus.textContent=e.about,k.userImage.src=e.avatar,c(r)})).catch((function(e){console.error(e)})).finally((function(){_(!1,i)}))}))}(M),function(e,t){var r=e.form,o=e.popup,s=e.inputPlace,i=e.inputLink,a=e.submitButtonSelector,d=e.stateClass,p=r.querySelector(a);r.addEventListener("submit",(function(e){var a,m;e.preventDefault(),_(!0,p),(a=s.value,m=i.value,fetch(u.cardsAdress,{method:"POST",headers:u.headers,body:JSON.stringify({name:a,link:m})}).then((function(e){return l(e)}))).then((function(s){y(t,s.name,s.link,s.likes,s.owner._id,s._id),c(o),e.target.reset(),n(r,p,d)})).catch((function(e){console.error(e)})).finally((function(){_(!1,p)}))}))}(J,S),function(e){var t=e.form.querySelector(e.submitSelector);e.form.addEventListener("submit",(function(r){var o;r.preventDefault(),_(!0,t),(o=e.input.value,fetch("".concat(u.userAdress,"/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:o})}).then((function(e){return l(e)}))).then((function(o){k.userName.textContent=o.name,k.userStatus.textContent=o.about,k.userImage.src=o.avatar,r.target.reset(),n(e.form,t,e.stateClass),c(e.popup)})).catch((function(e){console.error(e)})).finally((function(){_(!1,t)}))}))}(U)})).catch((function(e){console.error("".concat(e," Отказано в доступе или умер сервер"))}))})();